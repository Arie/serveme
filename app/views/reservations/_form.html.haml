.row
  .col-md-12
    %p.alert.alert-warning
      Please pick your start and end time carefully, reservations that have no players for 30 minutes (60 minutes for premium users) get ended automatically and you will receive a 24h temp ban. Use the "idle reset" button if you need more time before you start (e.g. your lobby takes a long time to fill). All times are in timezone:
      = link_to(Time.zone, edit_users_path)

= render "donator_nag"

= render "server_reservations_table"

.row
  .col-md-12.col-lg-6.offset-lg-2
    = simple_form_for(@reservation, wrapper: :horizontal_form, :html => { :class => 'form-horizontal reservation' }) do |f|
      - if @reservation.schedulable?
        = f.input :starts_at,       :as => :string, :input_html => { :value => I18n.l(@reservation.starts_at, :format => :datepicker), :data => { :"datepicker-format" => "dd-mm-yyyy hh:ii", :"datepicker-nodefault" => "false" } }, :label => "Starts at"
        = f.input :ends_at,         :as => :string, :input_html => { :value => I18n.l(@reservation.ends_at,   :format => :datepicker), :data => { :"datepicker-format" => "dd-mm-yyyy hh:ii", :"datepicker-nodefault" => "false" } }, :label => "Ends at"

      :javascript
        free_servers = #{free_servers.map { |s| {id: s.id, text: s.name, flag: s.location_flag, ip_and_port: "#{s.ip}:#{s.port}"} }.to_json.html_safe};
        find_server_url = "#{@reservation.persisted? ? find_servers_for_reservation_reservations_path(id: @reservation.id) : find_servers_for_user_reservations_path}";

      = f.input :server_id, :label => "Server", :required => true, :disabled => !@reservation.schedulable?, label: "<span class='icon-spinner'><i class='fa fa-spinner fa-spin'></i></span>Server".html_safe
      - if @reservation.schedulable? && !current_user.donator?
        - free_donator_servers_count = Server.for_donators.active.count - used_donator_server_count
        - if free_donator_servers_count > 0
          .buy_premium.form-group
            .col
              .alert.alert-warning
                No servers available for you during the selected times.
                Premium users have #{I18n.t(:available, :count => free_donator_servers_count, :scope => :server)} right now.
                = link_to("Buy premium and get instant access!", donate_path)

      .form-group.row.string.readonly.reservation_ping.form-group-valid
        %label.col-sm-3.col-md-3.col-form-label.string{for: 'reservation_ping'}
          %span.icon-spinner
            %i.fa.fa-spinner.fa-spin
          Ping
        .col-sm-3.col-md-3
          %input#reservation_ping.string.optional.readonly.disabled.form-control{disabled: "disabled", type: "text"}

      = f.input :password,            :as => :string, :placeholder => "The server password to join the game"
      = f.input :rcon,                :as => :string, :placeholder => "The RCON password to control the server",        :disabled => !@reservation.schedulable?
      = f.input :first_map,           :collection => MapUpload.available_maps, :input_html => { :class => "select2" },  :disabled => !@reservation.schedulable?
      = f.input :tv_password,         :as => :string,   :placeholder => "Password for STV, default tv"
      = f.input :tv_relaypassword,    :as => :string,   :placeholder => "Password for STV (relay), default tv"
      = f.association :server_config, :collection => ServerConfig.ordered, :hint => "Specify a league config to run on each map start", :input_html => { :class => "select2" }

      - users_last_reservation = current_user.reservations.last
      - if users_last_reservation && users_last_reservation.past? && users_last_reservation.inactive_too_long?
        - hint = "Auto-ending is forced on for your next reservation, because you didn't end your last one"
        - readonly = true
      - else
        - hint = "Automatically end the reservation once everyone has left the server"
        - readonly = false
      = f.input :auto_end, :as => :boolean, :hint => hint, :readonly => readonly, :disabled => readonly, :input_html => { :value => true }

      .row.submit-row
        .col-sm-2.offset-sm-4.col-lg-2.offset-lg-5
          %button.btn.btn-success{:type => :submit}
            Save

    = render "datepicker_javascript_options"

    :javascript
      var canEnablePlugins = #{(!current_user.donator? || !@reservation.schedulable? )};
      var reservationSchedulable = #{@reservation.schedulable?}
